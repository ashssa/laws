---
export async function getStaticPaths() {
  // 動態抓取所有 Markdown
  const allPosts = import.meta.glob('../../content/blog/*.md', { eager: true });

  // 收集所有 tag
  const tagsSet = new Set();
  Object.values(allPosts).forEach(post => {
    if (post.frontmatter.tags) {
      post.frontmatter.tags.forEach(tag => tagsSet.add(tag));
    }
  });

  // 生成每個 tag 的路由
  return Array.from(tagsSet).map(tag => ({ params: { tag } }));
}

// 取得目前 tag
const { tag } = Astro.params;

// 重新抓取所有文章
const allPosts = import.meta.glob('../../content/blog/*.md', { eager: true });

// 篩選出含有當前 tag 的文章
const filtered = Object.values(allPosts).filter(p =>
  p.frontmatter.tags?.includes(tag)
);
---
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <title>標籤：{tag}</title>
    <link rel="stylesheet" href="/blog/styles.css" />
  </head>
  <body class="max-w-3xl mx-auto px-4 py-8 font-sans">
    <h1 class="text-3xl font-bold mb-4">標籤：#{tag}</h1>
    <ul class="space-y-3">
      {filtered.map(p => (
        <li>
          <a href={`/blog/posts/${p.slug}/`} class="text-blue-600 hover:underline">{p.title}</a>
        </li>
      ))}
    </ul>
  </body>
</html>
